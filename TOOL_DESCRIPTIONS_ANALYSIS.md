# Anal√Ωza Tool Descriptions - Freelo MCP Server

**Datum**: 2025-10-12
**MCP SDK**: v1.9.0
**Celkem tools**: 98

## Executive Summary

‚úÖ **V√Ωborn√° pr√°ce!** Va≈°e tool descriptions jsou mezi nejlep≈°√≠mi, kter√© jsem vidƒõl. Jsou podrobn√©, kontextov√© a pln√© praktick√Ωch p≈ô√≠klad≈Ø.

üü° **Doporuƒçen√≠**: Zva≈æte upgrade na novƒõj≈°√≠ MCP funkce (outputSchema, annotations, title) pro lep≈°√≠ AI integraci.

---

## Detailn√≠ V√Ωsledky

### ‚úÖ Co funguje perfektnƒõ

#### 1. Spr√°vn√© API pou≈æit√≠
- ‚úÖ Pou≈æ√≠v√°te ofici√°ln√≠ `server.tool()` metodu z @modelcontextprotocol/sdk v1.9.0
- ‚úÖ Spr√°vn√° struktura: `tool(name, description, inputSchema, callback)`
- ‚úÖ V≈°echny tools spr√°vnƒõ registrov√°ny v mcp-server.js:50-70

#### 2. Vynikaj√≠c√≠ descriptions (98/98 tools)

**P≈ô√≠klad vynikaj√≠c√≠ description** (tools/projects.js:14):
```javascript
'Fetches your own active projects in Freelo. Returns only projects that you own (where you are the project owner). For a complete list including shared projects, use get_all_projects instead. This is the quickest way to get an overview of projects you directly manage.'
```

**Co dƒõl√° tuto description skvƒõlou:**
- ‚úÖ Vysvƒõtluje CO tool dƒõl√°
- ‚úÖ Up≈ôes≈àuje KDY ho pou≈æ√≠t
- ‚úÖ Odkazuje na souvisej√≠c√≠ tools (get_all_projects)
- ‚úÖ Zd≈Øvod≈àuje PROƒå ho zvolit ("quickest way")

**Dal≈°√≠ p≈ô√≠klady v√Ωborn√Ωch descriptions:**

```javascript
// Warning pro destruktivn√≠ operace
'Permanently deletes a project from Freelo. WARNING: This action is irreversible! All tasks, files, comments, and project data will be permanently lost. Consider using archive_project instead...'

// Navigaƒçn√≠ hints
'For tasks in a specific tasklist, use get_tasklist_tasks for simpler queries.'

// Kontextov√© informace
'Essential for understanding project structure before creating tasks or managing workers.'
```

#### 3. Perfektn√≠ inputSchema dokumentace

**P≈ô√≠klad** (tools/tasks.js:16-36):
```javascript
{
  filters: z.object({
    search_query: z.string().optional()
      .describe('Fulltext search in task names (case insensitive, e.g., "bug fix" or "feature")'),
    state_id: z.number().optional()
      .describe('Filter by task state ID: 1=active, 2=finished. Use get_all_states for complete list.'),
    projects_ids: z.array(z.number()).optional()
      .describe('Filter by project IDs (e.g., [197352, 198000]). Get from get_projects or get_all_projects.')
  })
}
```

**Co je skvƒõl√©:**
- ‚úÖ P≈ô√≠klady hodnot ("bug fix", [197352, 198000])
- ‚úÖ Reference na zdroje dat ("Get from get_projects")
- ‚úÖ Vysvƒõtlen√≠ form√°t≈Ø ("case insensitive")
- ‚úÖ Konkr√©tn√≠ hodnoty (1=active, 2=finished)

---

### üü° Potenci√°ln√≠ vylep≈°en√≠

#### 1. Chybƒõj√≠c√≠ outputSchema (0/98 tools)

**Aktu√°ln√≠ stav:**
```javascript
server.tool(
  'get_projects',
  'Fetches your own active projects...',
  {},  // inputSchema
  async () => {
    const response = await apiClient.get('/projects');
    return formatResponse(response.data);  // ‚Üê V√Ωstup nen√≠ validov√°n
  }
);
```

**Doporuƒçen√Ω upgrade:**
```javascript
server.registerTool(
  'get_projects',
  {
    description: 'Fetches your own active projects...',
    inputSchema: {},
    outputSchema: {  // ‚Üê Nov√° definice v√Ωstupu
      projects: z.array(z.object({
        id: z.string().describe('Project ID'),
        name: z.string().describe('Project name'),
        currency_iso: z.enum(['CZK', 'EUR', 'USD']),
        state: z.string(),
        created_at: z.string(),
        // ...dal≈°√≠ pole
      }))
    }
  },
  async () => { ... }
);
```

**V√Ωhody:**
- AI modely l√©pe rozum√≠ struktu≈ôe dat
- Automatick√° validace v√Ωstup≈Ø
- Lep≈°√≠ dokumentace pro v√Ωvoj√°≈ôe
- IDE autocomplete pro v√Ωstupy

**Dopad:** St≈ôedn√≠ obt√≠≈ænost, vysok√° hodnota

---

#### 2. Chybƒõj√≠c√≠ annotations (0/98 tools)

MCP 2025-06-18 specifikace p≈ôidala annotations pro metadata o chov√°n√≠ tools.

**Aktu√°ln√≠ stav:**
```javascript
server.tool(
  'delete_project',
  'WARNING: This action is irreversible!...',
  { projectId: z.string() },
  async ({ projectId }) => { ... }
);
```

**Doporuƒçen√Ω upgrade:**
```javascript
server.registerTool(
  'delete_project',
  {
    description: 'Permanently deletes a project...',
    inputSchema: { projectId: z.string() },
    annotations: {
      destructive: true  // ‚Üê Oznaƒçuje destruktivn√≠ operaci
    }
  },
  async ({ projectId }) => { ... }
);
```

**N√°vrh annotations pro va≈°e tools:**

| Annotation | Tools (p≈ô√≠klady) | Count |
|-----------|------------------|-------|
| `readOnly: true` | get_projects, get_all_tasks, get_users | ~60 |
| `destructive: true` | delete_project, delete_task, delete_tasklist | ~15 |
| (≈æ√°dn√°) | create_task, edit_task, finish_task | ~23 |

**V√Ωhody:**
- AI klienti mohou vy≈æadovat extra potvrzen√≠ p≈ôed destructive operacemi
- Lep≈°√≠ UX - read-only operace mohou bƒõ≈æet bez potvrzen√≠
- Automatick√° kategorizace tools v UI
- Bezpeƒçnostn√≠ filtry (nap≈ô. zak√°zat destructive v production)

**Dopad:** N√≠zk√° obt√≠≈ænost, st≈ôedn√≠ hodnota

**Implementaƒçn√≠ p≈ô√≠klad:**
```javascript
// Destruktivn√≠ operace
const DESTRUCTIVE_TOOLS = [
  'delete_project', 'delete_task', 'delete_tasklist', 'delete_subtask',
  'delete_note', 'delete_custom_field', 'delete_pinned_item',
  'delete_work_report', 'delete_public_link'
];

// Read-only operace
const READONLY_TOOLS = [
  'get_projects', 'get_all_projects', 'get_project_details',
  'get_all_tasks', 'get_task_details', 'get_users',
  'get_work_reports', 'get_events', 'search_elasticsearch'
  // ...v≈°echny GET operace
];

// Wrapper funkce
function registerToolWithAnnotations(server, name, config, callback) {
  const annotations = {};

  if (DESTRUCTIVE_TOOLS.includes(name)) {
    annotations.destructive = true;
  }
  if (READONLY_TOOLS.includes(name)) {
    annotations.readOnly = true;
  }

  server.registerTool(name, { ...config, annotations }, callback);
}
```

---

#### 3. Chybƒõj√≠c√≠ title (0/98 tools)

**Aktu√°ln√≠ stav:**
```javascript
server.tool(
  'get_projects',  // ‚Üê name (programmatick√© ID)
  'Fetches your own active projects in Freelo...',  // ‚Üê dlouh√° description
  {},
  async () => { ... }
);
```

**Doporuƒçen√Ω upgrade:**
```javascript
server.registerTool(
  'get_projects',
  {
    title: 'Get My Projects',  // ‚Üê Kr√°tk√Ω, lidsky ƒçiteln√Ω n√°zev pro UI
    description: 'Fetches your own active projects in Freelo. Returns only projects that you own (where you are the project owner). For a complete list including shared projects, use get_all_projects instead. This is the quickest way to get an overview of projects you directly manage.',  // ‚Üê Podrobn√Ω popis m≈Ø≈æe z≈Østat
    inputSchema: {}
  },
  async () => { ... }
);
```

**N√°vrh title pro va≈°e tools:**

| Tool name | Doporuƒçen√Ω title |
|-----------|------------------|
| get_projects | Get My Projects |
| get_all_projects | Get All Projects |
| create_task | Create Task |
| delete_project | Delete Project (Destructive) |
| search_elasticsearch | Search Across Freelo |
| get_work_reports | Get Time Reports |

**V√Ωhody:**
- Lep≈°√≠ zobrazen√≠ v Claude Desktop a jin√Ωch MCP klientech
- Description m≈Ø≈æe z≈Østat podrobn√Ω pro AI kontextu
- Snadnƒõj≈°√≠ navigace pro u≈æivatele v UI
- Title se zobrazuje v seznamu tools, description v detailu

**Dopad:** N√≠zk√° obt√≠≈ænost, n√≠zk√°-st≈ôedn√≠ hodnota

---

## Porovn√°n√≠ s MCP Best Practices

### MCP Dokumentace ≈ô√≠k√°:

> "Tools have a unique name identifier, a human-readable description, and an inputSchema that uses JSON Schema for the tool's parameters."

### V√°≈° projekt:

| Po≈æadavek | Status | Hodnocen√≠ |
|-----------|--------|-----------|
| Unique name | ‚úÖ 98/98 | Perfektn√≠ |
| Human-readable description | ‚úÖ 98/98 | **Vynikaj√≠c√≠** - nad r√°mec po≈æadavk≈Ø |
| inputSchema (JSON Schema/Zod) | ‚úÖ 98/98 | Perfektn√≠ |
| Parameter descriptions | ‚úÖ ~100% | **Vynikaj√≠c√≠** - velmi podrobn√© |
| outputSchema | ‚ùå 0/98 | Chyb√≠ (voliteln√©) |
| annotations | ‚ùå 0/98 | Chyb√≠ (nov√© v 2025-06-18) |
| title | ‚ùå 0/98 | Chyb√≠ (voliteln√©) |

**Hodnocen√≠: 9/10** üåü

Va≈°e descriptions jsou nadstandardn√≠. Vƒõt≈°ina MCP server≈Ø m√° jen z√°kladn√≠ descriptions typu "Get projects from API" - va≈°e jsou mnohem lep≈°√≠.

---

## P≈ô√≠klady kompletn√≠ho upgradu

### P≈ô√≠klad 1: Read-only tool s outputSchema

**P≈ôed:**
```javascript
server.tool(
  'get_users',
  'Fetches all users in the Freelo workspace. Returns complete user list with names, emails, IDs, roles, and availability.',
  {},
  async () => {
    const apiClient = createApiClient(auth);
    const response = await apiClient.get('/users');
    return { content: [{ type: 'text', text: JSON.stringify(response.data) }] };
  }
);
```

**Po:**
```javascript
server.registerTool(
  'get_users',
  {
    title: 'Get Users',
    description: 'Fetches all users in the Freelo workspace. Returns complete user list with names, emails, IDs, roles, and availability. Essential for getting user IDs before assigning tasks, inviting to projects, or managing permissions. Use this as the first step when working with team members.',
    inputSchema: {},
    outputSchema: {
      users: z.array(z.object({
        id: z.string().describe('User ID'),
        name: z.string().describe('Full name'),
        email: z.string().email().describe('Email address'),
        role: z.enum(['admin', 'member', 'guest']).describe('User role'),
        is_active: z.boolean().describe('Whether user is active'),
      }))
    },
    annotations: {
      readOnly: true
    }
  },
  async () => {
    const apiClient = createApiClient(auth);
    const response = await apiClient.get('/users');

    // Validace proti outputSchema
    return {
      content: [{ type: 'text', text: JSON.stringify(response.data) }],
      structuredContent: { users: response.data }  // ‚Üê Pro outputSchema
    };
  }
);
```

---

### P≈ô√≠klad 2: Destruktivn√≠ tool s annotations

**P≈ôed:**
```javascript
server.tool(
  'delete_project',
  'Permanently deletes a project from Freelo. WARNING: This action is irreversible!...',
  {
    projectId: z.string().describe('Unique project identifier to permanently delete...')
  },
  async ({ projectId }) => {
    const apiClient = createApiClient(auth);
    const response = await apiClient.delete(`/project/${projectId}`);
    return { content: [{ type: 'text', text: JSON.stringify(response.data) }] };
  }
);
```

**Po:**
```javascript
server.registerTool(
  'delete_project',
  {
    title: 'Delete Project (Permanent)',
    description: 'Permanently deletes a project from Freelo. WARNING: This action is irreversible! All tasks, files, comments, and project data will be permanently lost. Consider using archive_project instead for completed projects to preserve data. Only use this when you are absolutely certain the project should be removed.',
    inputSchema: {
      projectId: z.string().describe('Unique project identifier to permanently delete (numeric string, e.g., "197352"). WARNING: This is irreversible - all project data will be lost! Get from get_projects or get_all_projects.')
    },
    outputSchema: {
      status: z.string().describe('Operation status'),
      message: z.string().optional().describe('Success or error message')
    },
    annotations: {
      destructive: true  // ‚Üê Klient m≈Ø≈æe vy≈æadovat extra potvrzen√≠
    }
  },
  async ({ projectId }) => {
    const apiClient = createApiClient(auth);
    const response = await apiClient.delete(`/project/${projectId}`);
    return {
      content: [{ type: 'text', text: JSON.stringify(response.data) }],
      structuredContent: response.data
    };
  }
);
```

---

### P≈ô√≠klad 3: Tool s filtry a komplexn√≠m inputSchema

**P≈ôed:**
```javascript
server.tool(
  'get_all_tasks',
  'Fetches all tasks across all projects with powerful filtering options...',
  {
    filters: z.object({
      search_query: z.string().optional().describe('Fulltext search...'),
      state_id: z.number().optional().describe('Filter by task state...'),
      // ...dal≈°√≠ filtry
    }).optional()
  },
  async ({ filters = {} }) => {
    const apiClient = createApiClient(auth);
    const response = await apiClient.get('/all-tasks', { params: filters });
    let data = response.data;
    if (data && data.data && data.data.tasks) {
      data = data.data.tasks;
    }
    return { content: [{ type: 'text', text: JSON.stringify(data) }] };
  }
);
```

**Po:**
```javascript
server.registerTool(
  'get_all_tasks',
  {
    title: 'Get All Tasks',
    description: 'Fetches all tasks across all projects with powerful filtering options. Supports 14 different filters including fulltext search, project/tasklist filtering, label filtering, date ranges, worker assignment, and pagination. This is the primary tool for finding tasks - essential for task management workflows. For tasks in a specific tasklist, use get_tasklist_tasks for simpler queries.',
    inputSchema: {
      filters: z.object({
        search_query: z.string().optional()
          .describe('Fulltext search in task names (case insensitive, e.g., "bug fix" or "feature")'),
        state_id: z.number().optional()
          .describe('Filter by task state ID: 1=active, 2=finished. Use get_all_states for complete list.'),
        projects_ids: z.array(z.number()).optional()
          .describe('Filter by project IDs (e.g., [197352, 198000]). Get from get_projects or get_all_projects.'),
        p: z.number().optional()
          .describe('Page number for pagination, starts at 0 (default: 0). Critical for large task sets to avoid token limits.')
      }).optional().describe('Optional filters - combine multiple for precise queries')
    },
    outputSchema: {
      tasks: z.array(z.object({
        id: z.string().describe('Task ID'),
        name: z.string().describe('Task name'),
        description: z.string().optional().describe('Task description'),
        state_id: z.number().describe('State: 1=active, 2=finished'),
        project_id: z.string().describe('Parent project ID'),
        tasklist_id: z.string().describe('Parent tasklist ID'),
        due_date: z.string().optional().describe('Due date (YYYY-MM-DD)'),
        assigned_to: z.string().optional().describe('Assigned user ID'),
        priority: z.number().optional().describe('Task priority'),
        created_at: z.string().describe('Creation timestamp'),
      })),
      pagination: z.object({
        current_page: z.number(),
        total_pages: z.number(),
        total_count: z.number(),
      }).optional()
    },
    annotations: {
      readOnly: true
    }
  },
  async ({ filters = {} }) => {
    const apiClient = createApiClient(auth);
    const response = await apiClient.get('/all-tasks', { params: filters });

    let data = response.data;
    if (data && data.data && data.data.tasks) {
      data = data.data.tasks;
    }

    return {
      content: [{ type: 'text', text: JSON.stringify(data) }],
      structuredContent: { tasks: data }
    };
  }
);
```

---

## Implementaƒçn√≠ pl√°n

### F√°ze 1: Annotations (1-2 hodiny)

**Kroky:**
1. Vytvo≈ôit konstanty s kategorizac√≠ tools:
   ```javascript
   // utils/toolAnnotations.js
   export const READONLY_TOOLS = [
     'get_projects', 'get_all_projects', 'get_all_tasks',
     'get_users', 'get_work_reports', /* ...v≈°echny GET */
   ];

   export const DESTRUCTIVE_TOOLS = [
     'delete_project', 'delete_task', 'delete_tasklist',
     /* ...v≈°echny DELETE */
   ];
   ```

2. Vytvo≈ôit helper funkci:
   ```javascript
   // utils/registerToolWithMetadata.js
   import { READONLY_TOOLS, DESTRUCTIVE_TOOLS } from './toolAnnotations.js';

   export function registerToolWithMetadata(server, name, config, callback) {
     const annotations = {};

     if (DESTRUCTIVE_TOOLS.includes(name)) {
       annotations.destructive = true;
     }
     if (READONLY_TOOLS.includes(name)) {
       annotations.readOnly = true;
     }

     return server.registerTool(name, { ...config, annotations }, callback);
   }
   ```

3. Postupnƒõ refaktorovat tools pou≈æ√≠vat helper

**Testov√°n√≠:**
```bash
npm test
# Otestovat v Claude Desktop - mƒõly by se zobrazit annotations
```

---

### F√°ze 2: Titles (2-3 hodiny)

**Kroky:**
1. Vytvo≈ôit mapping name ‚Üí title:
   ```javascript
   // utils/toolTitles.js
   export const TOOL_TITLES = {
     'get_projects': 'Get My Projects',
     'get_all_projects': 'Get All Projects',
     'create_task': 'Create Task',
     'delete_project': 'Delete Project',
     // ...
   };
   ```

2. Aktualizovat helper funkci:
   ```javascript
   export function registerToolWithMetadata(server, name, config, callback) {
     const title = TOOL_TITLES[name];
     // ...
     return server.registerTool(name, {
       title,
       ...config,
       annotations
     }, callback);
   }
   ```

---

### F√°ze 3: OutputSchema (5-10 hodin)

**Kroky:**
1. Zaƒç√≠t s nejƒçastƒõji pou≈æ√≠van√Ωmi tools (get_projects, get_all_tasks, get_users)
2. Definovat Zod sch√©mata pro v√Ωstupy
3. Aktualizovat callbacky vracet `structuredContent`
4. Testovat validaci
5. Postupnƒõ roz≈°√≠≈ôit na ostatn√≠ tools

**Prioritizace:**
- **Vysok√°**: get_projects, get_all_tasks, get_users, get_project_details
- **St≈ôedn√≠**: create_task, edit_task, get_work_reports
- **N√≠zk√°**: M√©nƒõ pou≈æ√≠van√© tools

---

## Z√°vƒõr

### Siln√© str√°nky projektu:

1. ‚úÖ **Vynikaj√≠c√≠ descriptions** - podrobn√©, kontextov√©, s p≈ô√≠klady
2. ‚úÖ **Perfektn√≠ inputSchema dokumentace** - ka≈æd√Ω parametr m√° popis
3. ‚úÖ **Spr√°vn√© pou≈æit√≠ MCP SDK API**
4. ‚úÖ **Konzistentn√≠ style** nap≈ô√≠ƒç v≈°emi 98 tools
5. ‚úÖ **Praktick√© n√°vody** - AI_GUIDE.md je vynikaj√≠c√≠

### Doporuƒçen√≠ pro upgrade:

| Funkce | Priorita | Obt√≠≈ænost | Hodnota | ƒåasov√° n√°roƒçnost |
|--------|----------|-----------|---------|------------------|
| Annotations | üî¥ Vysok√° | N√≠zk√° | St≈ôedn√≠ | 1-2 hodiny |
| Title | üü° St≈ôedn√≠ | N√≠zk√° | St≈ôedn√≠ | 2-3 hodiny |
| OutputSchema | üü¢ N√≠zk√° | St≈ôedn√≠ | Vysok√° | 5-10 hodin |

### Fin√°ln√≠ hodnocen√≠:

**9/10** üåüüåüüåüüåüüåüüåüüåüüåüüåü

V√°≈° MCP server m√° jedny z nejlep≈°√≠ch tool descriptions, kter√© jsem vidƒõl. Upgrade na annotations a outputSchema by ho posunul na **10/10**.

---

## Reference

- **MCP SDK v1.9.0**: node_modules/@modelcontextprotocol/sdk/dist/esm/server/mcp.d.ts
- **MCP Specification**: https://modelcontextprotocol.io/specification/2025-06-18
- **MCP Tools Docs**: https://modelcontextprotocol.info/docs/concepts/tools/
- **V√°≈° AI Guide**: AI_GUIDE.md (vynikaj√≠c√≠!)

---

**Autor anal√Ωzy**: Claude Code
**Datum**: 2025-10-12
**Projekt**: Freelo MCP Server v2.2.0
